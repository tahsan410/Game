<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TF OVI - Balanced Speed</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; background: #001f3f; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        #container { position: relative; border: 4px solid #fff; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.5); overflow: hidden; width: 95vw; height: 95vh; max-width: 1000px; max-height: 600px; }
        canvas { background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%); width: 100%; height: 100%; display: block; cursor: crosshair; }
        
        .ui { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; width: 100%; z-index: 20; }
        .msg { font-size: clamp(24px, 6vw, 50px); font-weight: 900; text-transform: uppercase; display: none; text-shadow: 4px 4px 0px #000; }
        .success { color: #00ff88; }
        .fail { color: #ff4b2b; position: absolute; top: -120px; left: 50%; transform: translateX(-50%); width: 100%; }
        
        #retryBtn { margin-top: 20px; padding: 15px 35px; font-size: 18px; font-weight: bold; background: #fff; color: #333; border: none; border-radius: 50px; cursor: pointer; pointer-events: auto; display: none; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #retryBtn:hover { background: #00ff88; transform: scale(1.1); }
        .game-title { position: absolute; top: 15px; left: 15px; color: white; font-size: 16px; font-weight: bold; opacity: 0.7; z-index: 25; }
    </style>
</head>
<body>

<div id="container">
    <div class="game-title">TFO</div>
    <div class="ui">
        <div id="msgSuccess" class="msg success">MOJNUR POLAR MATHA LAGSE!<br>SHABBAS!!</div>
        <button id="retryBtn" onclick="restartGame()">PLAY AGAIN</button>
        <div id="msgFail" class="msg fail">SORRY TOBLA, TRY AGAIN!!</div>
    </div>
    <canvas id="gameCanvas"></canvas>
</div>

<audio id="hitSound" src="hit.mp3"></audio>
<audio id="missSound" src="miss.mp3"></audio>
<audio id="bgMusic" src="tabla.mp3" loop></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const bgMusic = document.getElementById('bgMusic');

canvas.width = 1000;
canvas.height = 600;

const playerImg = new Image(); playerImg.src = 'rifat_cir.png';
const targetImg = new Image(); targetImg.src = 'atik_cir.png';

let projectile = { x: 180, y: 430, r: 35, vx: 0, vy: 0, launched: false, angle: 0 };
let origin = { x: 180, y: 430 };
// টার্গেট স্পিড কমানো হয়েছে ১.৫-এ
let target = { x: 850, y: 150, r: 40, speed: 1.5 }; 
let isDragging = false;
let isGameOver = false;
let clouds = [{x: 100, y: 80}, {x: 450, y: 50}, {x: 800, y: 100}];

function getPointerPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
        x: (clientX - rect.left) * (canvas.width / rect.width),
        y: (clientY - rect.top) * (canvas.height / rect.height)
    };
}

function handleStart(e) {
    if (bgMusic.paused) { bgMusic.play().catch(() => {}); bgMusic.volume = 0.4; }
    if(!projectile.launched && !isGameOver) {
        const pos = getPointerPos(e);
        if(Math.hypot(pos.x - projectile.x, pos.y - projectile.y) < 70) isDragging = true;
    }
}

function handleMove(e) {
    if(isDragging) {
        const pos = getPointerPos(e);
        projectile.x = pos.x;
        projectile.y = pos.y;
        if(e.cancelable) e.preventDefault();
    }
}

function handleEnd() {
    if(isDragging) {
        isDragging = false;
        projectile.launched = true;
        projectile.vx = (origin.x - projectile.x) * 0.12; 
        projectile.vy = (origin.y - projectile.y) * 0.12;
    }
}

canvas.addEventListener('mousedown', handleStart);
window.addEventListener('mousemove', handleMove);
window.addEventListener('mouseup', handleEnd);
canvas.addEventListener('touchstart', handleStart, {passive: false});
window.addEventListener('touchmove', handleMove, {passive: false});
window.addEventListener('touchend', handleEnd);

function drawEnvironment() {
    ctx.fillStyle = "#FFD700";
    ctx.beginPath(); ctx.arc(100, 80, 40, 0, Math.PI * 2); ctx.fill();

    ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
    clouds.forEach(c => {
        ctx.beginPath();
        ctx.arc(c.x, c.y, 25, 0, Math.PI * 2);
        ctx.arc(c.x + 30, c.y - 10, 35, 0, Math.PI * 2);
        ctx.arc(c.x + 65, c.y, 25, 0, Math.PI * 2);
        ctx.fill();
        if(!isGameOver) c.x += 0.3; 
        if(c.x > canvas.width + 100) c.x = -100;
    });

    ctx.fillStyle = "#27ae60"; 
    ctx.fillRect(0, 520, canvas.width, 80);
    ctx.fillStyle = "#1e8449";
    for(let i=0; i<canvas.width; i+=25) {
        ctx.beginPath();
        ctx.moveTo(i, 520); ctx.lineTo(i+12, 502); ctx.lineTo(i+25, 520);
        ctx.fill();
    }
}

function drawSlingshot(px, py) {
    ctx.strokeStyle = "#5D4037"; ctx.lineWidth = 10; ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(origin.x, 520); ctx.lineTo(origin.x, 430);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(origin.x, 430); ctx.lineTo(origin.x - 25, 395);
    ctx.moveTo(origin.x, 430); ctx.lineTo(origin.x + 25, 395);
    ctx.stroke();

    if (!projectile.launched && !isGameOver) {
        ctx.strokeStyle = "#3E2723"; ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.moveTo(origin.x - 20, 400); ctx.lineTo(px, py);
        ctx.moveTo(origin.x + 20, 400); ctx.lineTo(px, py);
        ctx.stroke();
    }
}

function draw() {
    if (isGameOver) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    drawEnvironment();
    drawSlingshot(projectile.x, projectile.y);

    // টার্গেট মুভমেন্ট (ধীর গতিতে)
    target.y += target.speed;
    if(target.y < 100 || target.y > 400) target.speed *= -1;
    if (targetImg.complete) {
        ctx.drawImage(targetImg, target.x - target.r, target.y - target.r, target.r*2, target.r*2);
    }

    if(projectile.launched) {
        projectile.x += projectile.vx;
        projectile.y += projectile.vy;
        projectile.vy += 0.22; 
        projectile.angle += 0.12;

        let dist = Math.hypot(projectile.x - target.x, projectile.y - target.y);
        if(dist < projectile.r + target.r - 5) {
            document.getElementById('hitSound').play();
            bgMusic.pause();
            isGameOver = true;
            document.getElementById('msgSuccess').style.display = 'block';
            document.getElementById('retryBtn').style.display = 'inline-block';
        }
        
        if(projectile.x > canvas.width + 50 || projectile.y > canvas.height + 50 || projectile.x < -50) {
            document.getElementById('missSound').play();
            const failMsg = document.getElementById('msgFail');
            failMsg.style.display = 'block';
            setTimeout(() => { failMsg.style.display = 'none'; }, 1200);
            projectile.launched = false; projectile.x = origin.x; projectile.y = origin.y;
        }
    }

    ctx.save();
    ctx.translate(projectile.x, projectile.y);
    if(projectile.launched) ctx.rotate(projectile.angle);
    if (playerImg.complete) {
        ctx.drawImage(playerImg, -projectile.r, -projectile.r, projectile.r*2, projectile.r*2);
    }
    ctx.restore();

    requestAnimationFrame(draw);
}

function restartGame() {
    isGameOver = false;
    document.getElementById('msgSuccess').style.display = 'none';
    document.getElementById('retryBtn').style.display = 'none';
    bgMusic.currentTime = 0; bgMusic.play();
    projectile.launched = false; projectile.x = origin.x; projectile.y = origin.y;
    draw();
}

playerImg.onload = targetImg.onload = () => { draw(); };
</script>
</body>
</html>
